<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup :: Template Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/eap-on-openshift/04-deploy-with-operator.html">
    <link rel="prev" href="03-build-with-helm.html">
    <link rel="next" href="05-intro-to-EAP-xp.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">Template Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="eap-on-openshift" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-overview.html">Overview of JBoss EAP on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#benefits">Benefits of running JBoss EAP on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#cloud-native">Cloud native development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#modernization">Modernization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#build">Building for OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#deployment">Deploying on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#clustering">Clustering JBoss EAP applications on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#autoscaling">Autoscaling applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#graceful-shutdown">Graceful shutdown</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#https">HTTPS configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#platform-options">OpenShift platform options</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pre-reqs.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-mta.html">Migration Toolkit for Applications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#installation">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#cloud-readiness">Perform cloud readiness check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#the-report">Understanding the report</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-build-with-helm.html">Building JBoss EAP images with Helm</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#prereqs">Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#connectdb">Configuring JBoss EAP to connect to the postgres database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#build">Building JBoss EAP images with Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#chained-builds">S2I chained builds</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#deploy">Application deployment with helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#testing">Testing the application</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-deploy-with-operator.html">Deploying applications with the JBoss EAP Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install">Installing the JBoss EAP Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#deploy">Deploy JBoss EAP application with the operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-intro-to-EAP-xp.html">Introduction to JBoss EAP XP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-intro-to-EAP-xp.html#xponopenshift">Deploying JBoss EAP XP applications on OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-adding-microprofile.html">Adding MicroProfile support with JBoss EAP XP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#health">Adding a MicroProfile health check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#build">Building a MicroProfile application image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#testing">Testing MicroProfile health implementation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="07-content-trimming.html">Using capability trimming to reduce image size</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-content-trimming.html#implement">Implement capability trimming</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="08-observability.html">Observability and Monitoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="08-observability.html#prometheus">Deploy prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="08-observability.html#custom">Custom metrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-whats-next.html">What&#8217;s next</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Re-platform JBoss EAP on OpenShift</a></li>
    <li><a href="04-deploy-with-operator.html">Deploying applications with the JBoss EAP Operator</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/deewhyweb/replatform-jboss-eap-openshift/edit/master/documentation/modules/ROOT/pages/04-deploy-with-operator.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup</h1>
<div class="sect1">
<h2 id="_deploying_applications_with_the_jboss_eap_operator"><a class="anchor" href="#_deploying_applications_with_the_jboss_eap_operator"></a>Deploying applications with the JBoss EAP Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we&#8217;ve seen from the previous sections the Helm chart will create the required objects to build and deploy JBoss EAP applications.  An alternate approach is to use thee Helm chart to perform the build only and the JBoss EAP operator to deploy the applicatioon.
The JBoss EAP operator is an ideal way to deploy JBoss EAP applications on OpenShift.  The operator provides the following benefits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploys the application using stateful sets ensuring static hostnames</p>
</li>
<li>
<p>Ability to manage multiple JBoss EAP applications</p>
</li>
<li>
<p>Enables transaction recovery with safe shutdown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>First we&#8217;ll remove the deployment option from the Helm chart we created in the last section.  To do this, edit the eap74 helm chart and replace the yaml with the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">build:
  enabled: true
  env:
    - name: CUSTOM_INSTALL_DIRECTORIES
      value: extensions
  mode: s2i
  output:
    kind: ImageStreamTag
  ref: legacy
  s2i:
    amd64:
      jdk11:
        builderImage: registry.redhat.io/jboss-eap-7/eap74-openjdk11-openshift-rhel8
        runtimeImage: registry.redhat.io/jboss-eap-7/eap74-openjdk11-runtime-openshift-rhel8
      jdk8:
        builderImage: registry.redhat.io/jboss-eap-7/eap74-openjdk8-openshift-rhel7
        runtimeImage: registry.redhat.io/jboss-eap-7/eap74-openjdk8-runtime-openshift-rhel7
    arch: amd64
    galleonLayers:
      - jaxrs-server
    jdk: '11'
    version: latest
  uri: 'https://github.com/deewhyweb/wildfly-s2i-db.git'
deploy:
  enabled: false
image:
  tag: latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will disable the deployment and remove the deployment artifacts created by the helm chart.  We&#8217;ll now use the JBoss EAP Operator to deploy the image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install"><a class="anchor" href="#install"></a>Install the JBoss EAP Operator.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operators need to be installed by a user with the cluster admin role.  Login to OpenShift as a cluster admin and navigate to Operators &#8594; Operator hub.</p>
</div>
<div class="paragraph">
<p>Enter "EAP" in the "Filter by keyword" box.  Select the "JBoss EAP" operator.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-operator.png" alt="eap operator">
</div>
</div>
<div class="paragraph">
<p>Click on "Install"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-operator-install.png" alt="eap operator install">
</div>
</div>
<div class="paragraph">
<p>Leave the default options unchanged and click on "Install" to make the operator available for all namespaces.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-operator-progress.png" alt="eap operator progress">
</div>
</div>
<div class="paragraph">
<p>After a few minutes the JBoss EAP operator will be deployed and ready to use.</p>
</div>
<div class="paragraph">
<p>Now that the JBoss EAP operator is installed we can switch back to the developer-ui, all remaining tasks can be completed without cluster admin rights.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy"><a class="anchor" href="#deploy"></a>Deploy JBoss EAP application with the operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Switch back to the developer-ui and click on "+Add" to add a new application.</p>
</div>
<div class="paragraph">
<p>Select "Operator Backed"</p>
</div>
<div class="paragraph">
<p>You should see the "Wildfly server" option</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/select-operator.png" alt="select operator">
</div>
</div>
<div class="paragraph">
<p>Click on "Wildfly server"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/wildfly-server.png" alt="wildfly server">
</div>
</div>
<div class="paragraph">
<p>Click on Create and switch to "Yaml view"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/yaml-view.png" alt="yaml view">
</div>
</div>
<div class="paragraph">
<p>Paste the following yaml to configure the deployment</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: wildfly.org/v1alpha1
kind: WildFlyServer
metadata:
  name: example
spec:
  applicationImage: 'eap74:latest'
  env:
    - name: TEST_DATABASE
      valueFrom:
        secretKeyRef:
          key: database-name
          name: postgresql
    - name: TEST_PASSWORD
      valueFrom:
        secretKeyRef:
          key: database-password
          name: postgresql
    - name: TEST_USERNAME
      valueFrom:
        secretKeyRef:
          key: database-user
          name: postgresql
    - name: DATASOURCES
      value: TEST
    - name: TEST_DRIVER
      value: postgresql
    - name: TEST_JNDI
      value: 'java:/jdbc/postgresql'
    - name: TEST_NAME
      value: postgresql
    - name: TEST_URL
      value: 'jdbc:postgresql://postgresql:5432/demodb'
    - name: TEST_NONXA
      value: 'true'
  replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on "Create" to start the deployment.</p>
</div>
<div class="paragraph">
<p>You will be taken to the topology view</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/operator-topology.png" alt="operator topology">
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see from the topology a number of objects where created by the wildfly server custom resource.</p>
</div>
<div class="paragraph">
<p>Once the pod has completed start-up, click on <span class="image"><img src="_images/open-url.png" alt="open url"></span> to view the application&#8217;s landing page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve successfully completed the deployment of our application with the JBoss EAP operator.  Next we&#8217;ll look at how to make our application more container-native with JBoss EAP XP (expansion pack)</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-build-with-helm.html">Building JBoss EAP images with Helm</a></span>
  <span class="next"><a href="05-intro-to-EAP-xp.html">Introduction to JBoss EAP XP</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
