<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup :: Template Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/eap-on-openshift/07-content-trimming.html">
    <link rel="prev" href="06-adding-microprofile.html">
    <link rel="next" href="08-observability.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">Template Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="eap-on-openshift" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-overview.html">Overview of JBoss EAP on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#benefits">Benefits of running JBoss EAP on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#cloud-native">Cloud native development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#modernization">Modernization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#build-deploy">Building and deployment options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#clustering">Clustering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#autoscaling">Auto-scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#graceful-shutdown">Graceful shutdown</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#https">HTTPS configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-overview.html#platform-options">Platform options</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pre-reqs.html">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-mta.html">Migration Toolkit for Applications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#installation">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#cloud-readiness">Perform cloud readiness check</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-mta.html#the-report">Understanding the report</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-build-with-helm.html">Building JBoss EAP images with Helm</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-build-with-helm.html#chained-builds">S2I chained builds</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-deploy-with-operator.html">Deploying applications with the JBoss EAP Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-deploy-with-operator.html#install">Installing the JBoss EAP Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-deploy-with-operator.html#deploy">Deploying applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-intro-to-EAP-xp.html">Introduction to JBoss EAP XP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-intro-to-EAP-xp.html#microprofile">Microprofile</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-intro-to-EAP-xp.html#bootable-jar">Bootable JAR</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-intro-to-EAP-xp.html#content-trimming">capability trimming</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-adding-microprofile.html">Adding MicroProfile support with JBoss EAP XP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#adding-xp">Adding XP to JBoss EAP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#pom-dependencies">Addition of dependencies to POM file</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#annotations">Addition of annotations and code</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-adding-microprofile.html#deployment">Deployment to EAP instance with XP installed</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="07-content-trimming.html">Using capability trimming to reduce resource usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-observability.html">Observability and Monitoring</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="09-whats-next.html">What&#8217;s next</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-whats-next.html#cicd">Integration with traditional CI/CD tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09-whats-next.html#tekton">Cloud native CI with Tekton</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Re-platform JBoss EAP on OpenShift</a></li>
    <li><a href="07-content-trimming.html">Using capability trimming to reduce resource usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/deewhyweb/replatform-jboss-eap-openshift/edit/master/documentation/modules/ROOT/pages/07-content-trimming.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup</h1>
<div class="sect1">
<h2 id="_capability_trimming"><a class="anchor" href="#_capability_trimming"></a>Capability Trimming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When building an image that includes JBoss EAP, you can control the JBoss EAP features and subsystems to include in the image.</p>
</div>
<div class="paragraph">
<p>The default JBoss EAP server included in S2I images includes the complete server and all features. You might want to trim the capabilities included in the provisioned server. For example, you might want to reduce the security exposure of the provisioned server, or you might want to reduce the memory footprint so it is more appropriate for a microservice container.</p>
</div>
<div class="paragraph">
<p>For more information on the layers available checkout the <a href="https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.4/html/getting_started_with_jboss_eap_for_openshift_container_platform/capability-trimming-eap-foropenshift_default">documentation</a></p>
</div>
<div class="paragraph">
<p>In this section we&#8217;re going to use EAP XP capability trimming to reduce our application image size and resource consumption.</p>
</div>
<div class="paragraph">
<p>Before we start, we&#8217;re going to take a baseline of the current image size and resource consumption.</p>
</div>
<div class="paragraph">
<p>Image size:</p>
</div>
<div class="paragraph">
<p>Looking at the current image size, we should see something like 660mb</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-image-size.png" alt="eap image size">
</div>
</div>
<div class="paragraph">
<p>Resource usage:</p>
</div>
<div class="paragraph">
<p>Looking at the current resource usage, we should see something like 405mb</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-resource-usage.png" alt="eap resource usage">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implement_capability_trimming"><a class="anchor" href="#_implement_capability_trimming"></a>Implement capability trimming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;re going to use only two layers for our application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jaxrs-server</p>
</li>
<li>
<p>observability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upgrade the helm chart with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">build:
  bootableJar:
    builderImage: 'registry.access.redhat.com/ubi8/openjdk-11:latest'
  enabled: true
  env:
    - name: CUSTOM_INSTALL_DIRECTORIES
      value: extensions
  mode: s2i
  output:
    kind: ImageStreamTag
  ref: main
  s2i:
    jdk: '11'
    galleonLayers:
      - jaxrs-server
      - observability
    jdk11:
      builderImage: registry.redhat.io/jboss-eap-7/eap-xp4-openjdk11-openshift-rhel8
      runtimeImage: registry.redhat.io/jboss-eap-7/eap-xp4-openjdk11-runtime-openshift-rhel8
    version: latest
  uri: 'https://github.com/deewhyweb/wildfly-s2i-db.git'
deploy:
  enabled: false
  route:
    enabled: true
    tls:
      enabled: true
      insecureEdgeTerminationPolicy: Redirect
      termination: edge
image:
  tag: latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the image size:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-galleon-image-size.png" alt="eap galleon image size">
</div>
</div>
<div class="paragraph">
<p>You should see the image size has dropped significantly to around 427mb, that&#8217;s a reduction of 35%</p>
</div>
<div class="paragraph">
<p>Check the resource usage:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/eap-content-trimming-ru.png" alt="eap content trimming ru">
</div>
</div>
<div class="paragraph">
<p>The memory usage should have also reduced from around 405mb to 380.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="06-adding-microprofile.html">Adding MicroProfile support with JBoss EAP XP</a></span>
  <span class="next"><a href="08-observability.html">Observability and Monitoring</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
